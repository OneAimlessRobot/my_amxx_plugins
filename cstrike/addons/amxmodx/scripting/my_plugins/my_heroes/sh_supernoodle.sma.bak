/* CVARS - copy and paste to shconfig.cfg

//SuperNoodle
SuperNoodle_level 9
SuperNoodle_health 200		//how much health SuperNoodle has
SuperNoodle_armor 100		//how much armor SuperNoodle has
SuperNoodle_m3mult 2.0		//Damage multiplyer for his M3
supernoodle_m249mult 1.5 //damage for his assault rifle
supernoodle_elitemult 2.5 //damage for his elites
supernoodle_g3sg1mult 2.5 //damage for his precision rifle

*/

#include <amxmod>
#include <Vexd_Utilities>
#include <engine>
#include <superheromod>

// GLOBAL VARIABLES
new gHeroName[]="SuperNoodle"
new bool:gHasSuperNoodlePower[SH_MAXSLOTS+1]
//----------------------------------------------------------------------------------------------
public plugin_init()
{
	// Plugin Info
	register_plugin("SUPERHERO SuperNoodle", "1.0", "TastyMedula")

	// DO NOT EDIT THIS FILE TO CHANGE CVARS, USE THE SHCONFIG.CFG
	register_cvar("SuperNoodle_level", "9")
	register_cvar("SuperNoodle_health", "200")
	register_cvar("SuperNoodle_armor", "100")
	register_cvar("supernoodle_m249mult", "1.5")
	register_cvar("supernoodle_elitemult", "1.5")
	register_cvar("SuperNoodle_m3mult", "2.0")
	register_cvar("SuperNoodle_scoutmult", "2.0")

	// FIRE THE EVENT TO CREATE THIS SUPERHERO!
	shCreateHero(gHeroName, "All GEARED UP!", "Super Shotgun, Precision & Assault Rifle & Dual Pistols from DUSK!/Extra Damage for all these/Unlimited Ammo. Extra HP and AP.", false, "SuperNoodle_level")

	// REGISTER EVENTS THIS HERO WILL RESPOND TO! (AND SERVER COMMANDS)
	// INIT
	register_srvcmd("SuperNoodle_init", "SuperNoodle_init")
	shRegHeroInit(gHeroName, "SuperNoodle_init")

	// EVENTS
	register_event("ResetHUD", "newSpawn","b")
	register_event("CurWeapon", "weaponChange", "be", "1=1")
	register_event("Damage", "SuperNoodle_damage", "b", "2!0")

	// Let Server know about SuperNoodle's Variable
	shSetMaxHealth(gHeroName, "SuperNoodle_health")
	shSetMaxArmor(gHeroName, "SuperNoodle_armor")
	shSetShieldRestrict(gHeroName)
}
//----------------------------------------------------------------------------------------------
public plugin_precache()
{
	precache_model("models/shmod/v_supernoodle_m3.mdl")
	precache_model("models/shmod/p_supernoodle_m3.mdl")
}
//----------------------------------------------------------------------------------------------
public SuperNoodle_init()
{
	// First Argument is an id
	new temp[6]
	read_argv(1,temp,5)
	new id = str_to_num(temp)

	// 2nd Argument is 0 or 1 depending on whether the id has the hero
	read_argv(2,temp,5)
	new hasPowers = str_to_num(temp)

	if (!is_user_connected(id)) return

	//Reset thier shield restrict status
	//Shield restrict MUST be before weapons are given out
	shResetShield(id)

	if ( is_user_alive(id) ) {
		if ( hasPowers ) {
			SuperNoodle_weapons(id)
			switchmodel(id)
		}
		//This gets run if they had the power but don't anymore
		else if ( !hasPowers && gHasSuperNoodlePower[id] ) {
			engclient_cmd(id, "drop", "weapon_m3")
			engclient_cmd(id, "drop", "weapon_m249")
			engclient_cmd(id, "drop", "weapon_elite")
			engclient_cmd(id, "drop", "weapon_scout")
			shRemHealthPower(id)
			shRemArmorPower(id)
		}
	}
	//Sets this variable to the current status
	gHasSuperNoodlePower[id] = (hasPowers != 0)
}
//----------------------------------------------------------------------------------------------
public newSpawn(id)
{
	if ( shModActive() && gHasSuperNoodlePower[id] && is_user_alive(id) ) {
		SuperNoodle_weapons(id)

	}
}
//----------------------------------------------------------------------------------------------
public SuperNoodle_weapons(id)
{
	if ( shModActive() && is_user_alive(id) ) {
		shGiveWeapon(id,"weapon_m3")
		shGiveWeapon(id,"weapon_m249")
		shGiveWeapon(id,"weapon_elite")
		shGiveWeapon(id,"weapon_scout")
	}
}
//----------------------------------------------------------------------------------------------
public switchmodel(id)
{
	if ( !is_user_alive(id) ) return

	new clip, ammo, wpnid = get_user_weapon(id, clip, ammo)
	if ( wpnid == CSW_M3 ) {
		// Weapon Model change thanks to [CCC]Taz-Devil
		Entvars_Set_String(id, EV_SZ_viewmodel, "models/shmod/v_SuperNoodle_m3.mdl")
		Entvars_Set_String(id, EV_SZ_weaponmodel, "models/shmod/p_SuperNoodle_m3.mdl")
	}
}
//----------------------------------------------------------------------------------------------
public weaponChange(id)
{
	if ( !gHasSuperNoodlePower[id] || !shModActive() ) return

	new wpnid = read_data(2)
	new clip = read_data(3)

	if ( wpnid != CSW_M3 ) return

	switchmodel(id)

	// Never Run Out of Ammo!
	if ( clip == 0 ) {
		shReloadAmmo(id)
	}
}
//----------------------------------------------------------------------------------------------
public SuperNoodle_damage(id)
{
	if ( !shModActive() || !is_user_alive(id) ) return

	new damage = read_data(2)
	new weapon, bodypart, attacker = get_user_attacker(id, weapon, bodypart)
	new headshot = bodypart == 1 ? 1 : 0

	if ( attacker <= 0 || attacker > SH_MAXSLOTS ) return

	if ( gHasSuperNoodlePower[attacker] && weapon == CSW_M3 && is_user_alive(id) ) {
		new extraDamage = floatround(damage * get_cvar_float("SuperNoodle_m3mult") - damage)
		if (extraDamage > 0) shExtraDamage(id, attacker, extraDamage, "super shotgun", headshot)
	
	}
	else if(gHasSuperNoodlePower[attacker] && weapon == CSW_SCOUT && is_user_alive(id) ){
		new extraDamage = floatround(damage * get_cvar_float("supernoodle_scoutmult") - damage)
		if(extraDamage > 0) shExtraDamage(id, attacker, extraDamage, "precisoin rifle", headshot)
			
	}
	else if(gHasSuperNoodlePower[attacker] && weapon == CSW_M249 && is_user_alive(id) ){
		new extraDamage = floatround(damage * get_cvar_float("supernoodle_m249mult") - damage)
		if(extraDamage > 0) shExtraDamage(id, attacker, extraDamage, "assault rifle", headshot)
			
	}
	else if(gHasSuperNoodlePower[attacker] && weapon == CSW_ELITE && is_user_alive(id) ){
		new extraDamage = floatround(damage * get_cvar_float("supernoodle_elitemult") - damage)
		if(extraDamage > 0) shExtraDamage(id, attacker, extraDamage, "dual pistols", headshot)
	}
}
//----------------------------------------------------------------------------------------------
public client_connect(id)
{
	gHasSuperNoodlePower[id] = false
}
//----------------------------------------------------------------------------------------------
