

#include "../my_include/superheromod.inc"
#include "special_fx_inc/sh_gatling_special_fx.inc"


// GLOBAL VARIABLES
new gHeroID
new const gHeroName[] = "Yakui the Maid"
new bool:gHasYakui[SH_MAXSLOTS+1]
new gNumPills[SH_MAXSLOTS+1]


new gHeroLevel
//new Float:pill_dmg_mult
new max_pills

//----------------------------------------------------------------------------------------------
public plugin_init()
{
	// Plugin Info
	register_plugin("SUPERHERO Yakui the Maid", "1.0", "TastyMedula")
	
	
	// DO NOT EDIT THIS FILE TO CHANGE CVARS, USE THE SHCONFIG.CFG
	register_cvar("yakui_level", "8")
	register_cvar("yakui_dmg_mult","1.0")
	register_cvar("yakui_pills","1000")
	gHeroID=shCreateHero(gHeroName, "Yakui the Maid", "NARCOTIC ARTILLERY", true, "yakui_level" )
	
	
	register_event("Damage", "yakui_damage", "b", "2!0")
	register_srvcmd("yakui_init", "yakui_init")
	shRegHeroInit(gHeroName, "yakui_init")
	RegisterHam(Ham_Weapon_SecondaryAttack, "weapon_m249", "gatling_shoot");
	RegisterHam(Ham_Weapon_PrimaryAttack, "weapon_m249", "gatling_shoot");
	
}

//----------------------------------------------------------------------------------------------
public plugin_cfg()
{
	loadCVARS();
}
//----------------------------------------------------------------------------------------------
public loadCVARS()
{
	gHeroLevel=get_cvar_num("yakui_level");
	//pill_dmg_mult=get_cvar_float("yakui_dmg_mult");
	max_pills=get_cvar_num("yakui_pills")
}
public yakui_init()
{
	
	// First Argument is an id
	new temp[6]
	read_argv(1,temp,5)
	new id=str_to_num(temp)
	
	read_argv(2,temp,5)
	new hasPowers = str_to_num(temp)
	gHasYakui[id]=(hasPowers!=0)
	if(gHasYakui[id]){
		init_yakui(id)
	}
	else{
	
		clear_yakui(id)
	}
	
	
}

init_yakui(id){

	gNumPills[id]=max_pills
	sh_chat_message(id,gHeroID,"You equipped pill gatling")
	yakui_weapons(id)



}
reset_yakui(id){

	if(!sh_is_active()||!gHasYakui[id]) return;
	
	
	sh_chat_message(id,gHeroID,"You reset pill gatling")
	gNumPills[id]=max_pills
	yakui_weapons(id)



}
clear_yakui(id){

	gNumPills[id]=0
	sh_chat_message(id,gHeroID,"You UNequipped pill gatling")
	sh_drop_weapon(id, CSW_M249, true)



}
public yakui_weapons(id){

if ( sh_is_active() && is_user_alive(id) && gHasYakui[id] ) {
	sh_give_weapon(id, CSW_M249)
	sh_chat_message(id,gHeroID,"You got your weapon!")
}

}

public yakui_damage(id){

if ( !shModActive() || !is_user_alive(id)  ) return

new damage = read_data(2)
new weapon, bodypart, attacker = get_user_attacker(id, weapon, bodypart)
new headshot = bodypart == 1 ? 1 : 0
if ( attacker <= 0 || attacker > SH_MAXSLOTS || attacker==id||!client_isnt_hitter(attacker) ) return

if ( gHasYakui[attacker]&&(weapon == CSW_M249))  {
	
	//new Float:extraDamage = damage * pill_dmg_mult - damage
	//if (floatround(extraDamage)>0){
		//shExtraDamage(id, attacker, floatround(extraDamage), "Gatling", headshot)
	//}
	sh_effect_user(id,attacker,gHeroID)
}

}
client_hittable(gatling_user,vic_userid,CsTeams:gatling_team){

return is_user_connected(vic_userid)&&is_user_alive(vic_userid)&&(vic_userid!=gatling_user)&&vic_userid&&(gatling_team!=cs_get_user_team(vic_userid))

}
client_isnt_hitter(gatling_user){

return (!shModActive()||!gHasYakui[gatling_user]||!gNumPills[gatling_user]||!is_user_alive(gatling_user)||gatling_user <= 0 || gatling_user > SH_MAXSLOTS)

}
public gatling_shoot(weaponent)
{
	
	
	new id = get_pdata_cbase(weaponent, 41, 4);
	if (client_isnt_hitter(id))return HAM_IGNORED
	gNumPills[id]-= (gNumPills[id]>0)? 1:0
	sh_chat_message(id,gHeroID,"gatling shot! %d pills left!!!!!",gNumPills[id])
	return HAM_IGNORED
}
//----------------------------------------------------------------------------------------------
public sh_client_spawn(id)
{
	if ( gHasYakui[id]&&is_user_alive(id) && sh_is_active() ) {
		
		sh_chat_message(id,gHeroID,"You spawned with pill gatling")
		reset_yakui(id)
		
	}
	
}





public plugin_precache()
{
	
	
}

