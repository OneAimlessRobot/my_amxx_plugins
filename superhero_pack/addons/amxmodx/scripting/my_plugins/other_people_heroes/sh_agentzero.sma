// AGENT ZERO!

/* CVARS - copy and paste to shconfig.cfg

//Agent Zero
agentz_level 5

*/

/*
* v1.2 - vittu - 3/8/11
*      - Made a few small adjustments to Fr33m@n's changes.
*
* v1.1 - Fr33m@n - 2/20/11
*      - Updated to be SH 1.2.0 compliant, removed amx compatibility.
*      - Re-coded and cleaned up.
*
*      Method based on OT's Recoil Control
*      Thanks to Arkshine for the NO_RECOIL_WEAPONS_BITSUM and The Art of War for the idea.
*/

#include "../my_include/superheromod.inc"

#define NO_RECOIL_WEAPONS_BITSUM ((1<<CSW_KNIFE)|(1<<CSW_HEGRENADE)|(1<<CSW_FLASHBANG)|(1<<CSW_SMOKEGRENADE)|(1<<CSW_C4))

#define XO_WEAPON 4
#define m_pPlayer 41

// GLOBAL VARIABLES
new gHeroID

//I don't like this bitwise use as it makes it harder for new people to read
//but since speed is imprortant to this plugin I won't change it. - vittu
new gAgentZero
#define SetAgentZero(%1)	gAgentZero |= 1<<(%1&31)
#define RemoveAgentZero(%1)	gAgentZero &= ~(1<<(%1&31))
#define GetAgentZero(%1)	(gAgentZero & 1<<(%1&31))
//----------------------------------------------------------------------------------------------
public plugin_init()
{
	// Plugin Info
	register_plugin("SUPERHERO Agent Zero", "1.2", "Freecode")

	// DO NOT EDIT THIS FILE TO CHANGE CVARS, USE THE SHCONFIG.CFG
	new pcvarLevel = register_cvar("agentz_level", "5")

	// FIRE THE EVENT TO CREATE THIS SUPERHERO!
	gHeroID = sh_create_hero("Agent Zero", pcvarLevel)
	sh_set_hero_info(gHeroID, "No Recoil", "Get No Recoil when shooting")

	new wpnName[32]
	for ( new wpnId = CSW_P228; wpnId <= CSW_P90; wpnId++ )
	{
		if ( !(NO_RECOIL_WEAPONS_BITSUM & (1<<wpnId)) && get_weaponname(wpnId, wpnName, charsmax(wpnName)) )
		{
			RegisterHam(Ham_Weapon_PrimaryAttack, wpnName, "Ham_Weapon_PrimaryAttack_Post", 1)
		}
	}
}
//----------------------------------------------------------------------------------------------
public sh_hero_init(id, heroID, mode)
{
	if ( gHeroID != heroID ) return

	if ( mode == SH_HERO_ADD ) {
		SetAgentZero(id)
	}
	else {
		RemoveAgentZero(id)
	}
}
//----------------------------------------------------------------------------------------------
public Ham_Weapon_PrimaryAttack_Post(weapon_ent)
{
	if ( !sh_is_active() ) return HAM_IGNORED

	new owner = get_pdata_cbase(weapon_ent, m_pPlayer, XO_WEAPON)

	if ( GetAgentZero(owner) ) {
		set_pev(owner, pev_punchangle, {0.0, 0.0, 0.0})
	}

	return HAM_IGNORED
}
//----------------------------------------------------------------------------------------------