/* Plugin generated by AMXX-Studio */

#include "../my_include/superheromod.inc"
#include "../my_heroes/sh_aux_stuff/sh_aux_inc.inc"

new gHeroID
new const gHeroName[] = "Stun Gun"
new gHasStunPower[SH_MAXSLOTS+1]
new bool:gHasStunned[SH_MAXSLOTS+1]

//cvars
new pcvarTimeToStun
new pcvarCooldown
new pcvarStunSpeed

public plugin_init()
{
	register_plugin("SUPERHERO Stun Gun", "1.3", "Jelle/Timian")
	
	new pcvarLevel = register_cvar("stun_level", "5")
	pcvarTimeToStun = register_cvar("stun_stuntime", "1")
	pcvarCooldown = register_cvar("stun_cooldown", "10")
	pcvarStunSpeed = register_cvar("stun_stunspeed", "100")
	
	gHeroID = sh_create_hero(gHeroName, pcvarLevel)
	sh_set_hero_info(gHeroID, "Stunning shots", "Stun gun slow down enemy on hit")
}

public sh_hero_init(id, heroID, mode)
{
	if ( gHeroID != heroID ) return
	
	if ( mode == SH_HERO_ADD )
	{
		gHasStunPower[id] = true
		
		gHasStunned[id] = false
	}
	
	else if ( mode == SH_HERO_DROP )
	{
		gHasStunPower[id] = false
	}
}

public sh_client_spawn(id)
{
	if ( gHasStunPower[id] )
	{
		gHasStunned[id] = false
		remove_task(id)
	}
}

public client_damage(attacker, victim)
{
	if(!client_hittable(attacker) ||!client_hittable(victim)|| victim==attacker) return

	if(!sh_is_active()) return
	
	if ( !gHasStunned[attacker] )
	{
		if ( gHasStunPower[attacker] )
		{
			sh_set_stun(victim, get_pcvar_float(pcvarTimeToStun), get_pcvar_float(pcvarStunSpeed))
			
			gHasStunned[attacker] = true
			
			set_task(get_pcvar_float(pcvarCooldown), "stun_again", attacker)
		}
	}
}

public stun_again(attacker)
{
	gHasStunned[attacker] = false
}