


//------- Do not edit below this point ------//

#include "../my_include/superheromod.inc"
#include "sh_aux_stuff/sh_aux_inc.inc"
#include "lena_inc/sh_lena_l96_include.inc"
#include "lena_inc/sh_lena_general_include.inc"

#define PLUGIN_AUTHOR "MilkChanTheGOAT"
#define PLUGIN_VER "1.0"
#define PLUGIN_NAME "SUPERHERO Lena de Verias"

// GLOBAL VARIABLES
new gHeroName[] = "L96A1"
new gHeroID;
new bool:gHasLena[SH_MAXSLOTS+1]
new gNumBullets[SH_MAXSLOTS+1]
new lena_max_bullets
new hud_sync

//----------------------------------------------------------------------------------------------
public plugin_init()
{
	// Plugin Info
	register_plugin(PLUGIN_NAME, PLUGIN_VER, PLUGIN_AUTHOR)

	// DO NOT EDIT THIS FILE TO CHANGE CVARS, USE THE SHCONFIG.CFG
	register_cvar("lena_level", "10")
	register_cvar("lena_num_bullets", "100")

	// FIRE THE EVENT TO CREATE THIS SUPERHERO!
	gHeroID=shCreateHero(gHeroName, "L96A1", "become Lena de Verias! Get her A.W.P.!", false, "lena_level")
	hud_sync=CreateHudSyncObj()

	// REGISTER EVENTS THIS HERO WILL RESPOND TO! (AND SERVER COMMANDS)
	// INIT
	register_srvcmd("lena_init", "lena_init")
	register_event("ResetHUD","new_spawn","b")
	shRegHeroInit(gHeroName, "lena_init")
	register_event("DeathMsg","death","a")
}

public plugin_natives(){

	register_native("lena_l96_dec_num_bullets","_lena_l96_dec_num_bullets",0);
	register_native("lena_l96_get_num_bullets","_lena_l96_get_num_bullets",0);
	register_native("lena_l96_set_num_bullets","_lena_l96_set_num_bullets",0);
	
	register_native("lena_get_has_lena","_lena_get_has_lena",0);
	
	register_native("lena_get_hero_id","_lena_get_hero_id",0);
	

	

}

//----------------------------------------------------------------------------------------------
public plugin_cfg()
{
	loadCVARS();
	
}

//----------------------------------------------------------------------------------------------
public loadCVARS()
{
	
	lena_max_bullets=get_cvar_num("lena_num_bullets")
}
public _lena_get_has_lena(iPlugin,iParams){
	new id=get_param(1)
	
	return gHasLena[id]

}

public _lena_l96_set_num_bullets(iPlugin,iParams){
	new id= get_param(1)
	new value_to_set=get_param(2)
	gNumBullets[id]=value_to_set;
}
public _lena_get_hero_id(iPlugin,iParams){
	
	return gHeroID
}
public _lena_l96_get_num_bullets(iPlugin,iParams){


	new id= get_param(1)
	return gNumBullets[id]

}

public _lena_l96_dec_num_bullets(iPlugin,iParams){


	new id= get_param(1)
	gNumBullets[id]-= (gNumBullets[id]>0)? 1:0

}

public lena_hud_task(id){
	id-=LENA_HUD_TASKID
	
	if(!is_user_alive(id)||!is_user_connected(id)||!lena_get_has_lena(id)){
		
		return
	}
	
	lena_hud(id)
	
	

}
lena_hud(id){
	new hud_msg[500];
	format(hud_msg,499,"[SH] %s:^nNum bullets left: %d^nCurr zoom mode: %d^n",
					gHeroName,
					lena_l96_get_num_bullets(id),
					lena_l96_get_user_zoom(id)
					);
	
	set_hudmessage(LineColorsWithAlpha[WHITE][0], LineColorsWithAlpha[WHITE][1], LineColorsWithAlpha[WHITE][2], 0.5, 0.05, 1, 0.0, 0.5,0.0,0.0,1)
	
	ShowSyncHudMsg(id, hud_sync, "%s", hud_msg)



}
public sh_round_end(){

	lena_l96_clear_bullets()

}
//----------------------------------------------------------------------------------------------
public plugin_precache()
{
}
//----------------------------------------------------------------------------------------------
public lena_init()
{
	// First Argument is an id
	new temp[6]
	read_argv(1, temp, 5)
	new id = str_to_num(temp)

	// 2nd Argument is 0 or 1 depending on whether the id has the hero
	read_argv(2, temp, 5)
	
	new hasPowers = str_to_num(temp)
	gHasLena[id]=(hasPowers!=0)
	if(gHasLena[id])
	{
		sh_give_weapon(id, LENA_WEAPON_CLASSID,false)
		set_task(0.1, "lena_hud_task", id+LENA_HUD_TASKID, "", 0, "b")
		lena_l96_set_user_zoom(id)
		new_spawn(id)
	}
	else
	{
		sh_drop_weapon(id,LENA_WEAPON_CLASSID,true);
		remove_task(id+LENA_HUD_TASKID)
		lena_l96_remove_user_zoom(id)
	}
}
public new_spawn(id)
{
	if ( sh_is_active() && is_user_alive(id) && lena_get_has_lena(id) )
	{
		gNumBullets[id]=lena_max_bullets
		lena_l96_reset_user_zoom(id)
	}
}
public sh_client_spawn(id)
{
	lena_weapons(id)

}
//----------------------------------------------------------------------------------------------
lena_weapons(id)
{
	if ( sh_is_active() && lena_get_has_lena(id)&&client_hittable(id) ) {
		sh_give_weapon(id, LENA_WEAPON_CLASSID,false)
		new weapon_id=find_ent_by_owner(-1,LENA_WEAPON,id);
		if(is_valid_ent(weapon_id)){
			cs_set_weapon_ammo(weapon_id, CLIP_SIZE);
			cs_set_user_bpammo(id, LENA_WEAPON_CLASSID,gNumBullets[id]-CLIP_SIZE);
		}
	}
}
//----------------------------------------------------------------------------------------------
public client_connect(id)
{
	gHasLena[id] = false
}
//----------------------------------------------------------------------------------------------

public death()
{	
	new id = read_data(2)
	if(lena_get_has_lena(id)){
		
		
		lena_l96_reset_user_zoom(id)
		
		
	}
	
}