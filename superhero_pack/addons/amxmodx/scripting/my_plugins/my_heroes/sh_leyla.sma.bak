

#include "../my_include/superheromod.inc"
#define CHIKOI_HITZONE_TASKID 19999
#define CHIKOI_HUD_TASKID 19999

// GLOBAL VARIABLES
new gHeroID
new const gHeroName[] = "Chikoi the Maid"
new bool:gHasChikoi[SH_MAXSLOTS+1]

new const redline_color[4]={255,1,1,1}

new hud_sync
new gHeroLevel

#define SENDAUDIO_MESSAGE_PITCH_ARG 3

//----------------------------------------------------------------------------------------------
public plugin_init()
{
	// Plugin Info
	register_plugin("SUPERHERO Chikoi the Maid", "1.0", "TastyMedula")
	
	
	// DO NOT EDIT THIS FILE TO CHANGE CVARS, USE THE SHCONFIG.CFG
	register_cvar("chikoi_level", "8")
	register_event("ResetHUD","newRound","b")
	gHeroID=shCreateHero(gHeroName, "Small maid!", "Become headshot only! But it really is headshot only! 1Shot 1Kill!", true, "chikoi_level" )
	hud_sync=CreateHudSyncObj()
	register_event("Damage", "chikoi_damage", "b", "2!0")
	register_event("DeathMsg","death","a")
	register_srvcmd("chikoi_init", "chikoi_init")
	shRegHeroInit(gHeroName, "chikoi_init")
	register_srvcmd("chikoi_kd", "chikoi_kd")
	shRegKeyDown(gHeroName, "chikoi_kd")
	
	
}


public chikoi_init()
{
	
	// First Argument is an id
	new temp[6]
	read_argv(1,temp,5)
	new id=str_to_num(temp)
	
	read_argv(2,temp,5)
	new hasPowers = str_to_num(temp)
	gHasChikoi[id]=(hasPowers!=0)
	if(gHasChikoi[id]){
		set_task(0.1, "hitzone_loop", id+CHIKOI_HITZONE_TASKID, "", 0, "b")
		set_task(0.1, "chikoi_hud_task", id+CHIKOI_HUD_TASKID, "", 0, "b")
		
	}
	else{
		remove_task(id+CHIKOI_HITZONE_TASKID)
		remove_task(id+CHIKOI_HUD_TASKID)
	}
	
	
}
public chikoi_damage(id){
if ( !shModActive() || !is_user_alive(id) ||!gHasChikoi[id]) return


new weapon, bodypart, attacker = get_user_attacker(id, weapon, bodypart)
new headshot = bodypart == 1 ? 1 : 0
if ( attacker <= 0 || attacker > SH_MAXSLOTS || attacker==id ) return
new attacker_name[128];
new client_name[128];
get_user_name(attacker,attacker_name,127);
get_user_name(id,client_name,127);

if(headshot){

	
	shExtraDamage(id, attacker, 1, "Smallness", headshot,SH_DMG_KILL)
	sh_chat_message(id,gHeroID,"%s has killed Chikoi the Maid (%s), the Small Maid, at your service.",attacker_name,client_name)

}

}
public chikoi_hitzones(id)
{
	if ( !shModActive() || !hasRoundStarted() ) return PLUGIN_CONTINUE
	if ( gHasChikoi[id] && is_user_alive(id) ) {
		
		set_user_hitzones(0, id, HITZONE_HEAD)	//remove left arm hitzone
		new client_name[128]
		get_user_name(id,client_name,127)
	}
	return PLUGIN_CONTINUE
}

public hitzone_loop(id){
	
	id-=CHIKOI_HITZONE_TASKID;
	
	if(gHasChikoi[id]){
		
		chikoi_hitzones(id)
		
		
	}
	
	
}
public chikoi_hud_task(id){
	id-=CHIKOI_HUD_TASKID
	if(gHasChikoi[id]){
		chikoi_hud(id)
		
	
	}
	

}
chikoi_hud(id){
	new hud_msg[128];
	format(hud_msg,127,"[SH] %s:^nHello player! I am Chikoi the maid, The Small Maid, at your service.",
					gHeroName
					);
	
	set_hudmessage(redline_color[0], redline_color[1], redline_color[2], 1.0, 0.2, redline_color[3], 0.0, 0.5,0.0,0.0,1)
	
	ShowSyncHudMsg(id, hud_sync, "%s", hud_msg)



}
//----------------------------------------------------------------------------------------------
public plugin_cfg()
{
	loadCVARS();
	
}
//----------------------------------------------------------------------------------------------
public loadCVARS()
{
	
	gHeroLevel=get_cvar_num("chikoi_level")
}
public reset_chikoi(id){

	if ( gHasChikoi[id]) {
	}

}
public chikoi_kd()
{
	new temp[6]
	
	// First Argument is an id with colussus Powers!
	read_argv(1,temp,5)
	new id=str_to_num(temp)
	
	if ( !is_user_alive(id)||!gHasChikoi[id]) return PLUGIN_HANDLED
	
	
	return PLUGIN_HANDLED
}
//----------------------------------------------------------------------------------------------
public newRound(id)
{	
if(is_user_alive(id) && shModActive()&&gHasChikoi[id]){ 
	reset_chikoi(id)	
}
return PLUGIN_HANDLED	
}
public plugin_precache()
{
		
}
public sh_round_end(){
		
		
}

public death()
{	/*
	new id = read_data(2)
	new killer= read_data(1)
	*/
}
/* AMXX-Studio Notes - DO NOT MODIFY BELOW HERE
*{\\ rtf1\\ ansi\\ deff0{\\ fonttbl{\\ f0\\ fnil Tahoma;}}\n\\ viewkind4\\ uc1\\ pard\\ lang2070\\ f0\\ fs16 \n\\ par }
*/
