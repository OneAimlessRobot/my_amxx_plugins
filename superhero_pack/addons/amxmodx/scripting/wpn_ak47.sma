/* Plugin generated by AMXX-Studio */

#include <amxmodx>
#include <weaponmod>
#include <fun>
#define PLUGIN "Ak47 With FireModes modes!"
#define VERSION "0.2.0"
#define AUTHOR "Darkness"

//Semi-Clip and Burst of your ass FTW
new SEMI_CLIP[33];

// Weapon information
new WPN_NAME[] = "Ak47 With FireModes";
new WPN_SHORT[] = "Ak47";

// Model information
new P_MODEL[] = "models/p_ak47.mdl";
new V_MODEL[] = "models/v_ak47.mdl";
new W_MODEL[] = "models/w_ak47.mdl";

// Sound information
new s_RELOAD_1[] = "weapons/ak47_clipout.wav";
new s_RELOAD_2[] = "weapons/ak47_clipin.wav";
new s_RELOAD_3[] = "weapons/ak47_boltpull.wav";
new s_FIRE[] = "weapons/ak47-1.wav";
new s_SWAP[] = "weapons/357_cock1.wav";

// Weapon's damages
#define DMG_PER_BULLET_MAX 15
#define DMG_PER_BULLET_MIN 10

// Sequences
enum
{
	anim_idle,
	anim_reload,
	anim_draw,
	anim_shoot1,
	anim_shoot2,
	anim_shoot3
}

// Variables
new g_wpnid;

public plugin_precache() {
	precache_model(P_MODEL);
	precache_model(V_MODEL);
	precache_model(W_MODEL);
	
	precache_sound(s_RELOAD_1);
	precache_sound(s_RELOAD_2);
	precache_sound(s_RELOAD_3);
	precache_sound(s_FIRE);
	precache_sound(s_SWAP);
}

public plugin_init() {
	register_plugin(PLUGIN, VERSION, AUTHOR);
	
	create_weapon();
	
}

create_weapon() {
	new wpnid = wpn_register_weapon(WPN_NAME,WPN_SHORT);
	if(wpnid == -1) {
		return PLUGIN_CONTINUE;
	}
	
	wpn_set_string(wpnid, wpn_viewmodel, V_MODEL);
	wpn_set_string(wpnid, wpn_weaponmodel, P_MODEL);
	wpn_set_string(wpnid, wpn_worldmodel, W_MODEL);
	
	wpn_register_event(wpnid, event_attack1, "ev_attack1");
	wpn_register_event(wpnid, event_attack2, "ev_attack2");
	wpn_register_event(wpnid, event_draw, "ev_draw");
	wpn_register_event(wpnid, event_reload, "ev_reload");
	
	wpn_set_float(wpnid, wpn_refire_rate1, 0.13);
	wpn_set_float(wpnid, wpn_refire_rate2, 0.5);
	wpn_set_float(wpnid, wpn_reload_time, 2.3);
	wpn_set_float(wpnid, wpn_recoil1, 1.5);
	wpn_set_float(wpnid, wpn_recoil2, 0.0);
	wpn_set_float(wpnid, wpn_run_speed, 340.0);
	
	wpn_set_integer(wpnid, wpn_ammo1, 32);
	wpn_set_integer(wpnid, wpn_ammo2, 150);
	wpn_set_integer(wpnid, wpn_bullets_per_shot1, 1);
	wpn_set_integer(wpnid, wpn_bullets_per_shot2, 0);
	wpn_set_integer(wpnid, wpn_cost, 16000);
	
	g_wpnid = wpnid;
	return PLUGIN_CONTINUE;
}

public ev_attack1(id) {
	if(( SEMI_CLIP[id] == 0)) { 
		wpn_playanim(id, random_num(anim_shoot1, anim_shoot3	));
		emit_sound(id, CHAN_WEAPON, s_FIRE, 1.0, ATTN_NORM, 0, PITCH_NORM);
		wpn_bullet_shot(g_wpnid, id, 0, random_num(DMG_PER_BULLET_MIN, DMG_PER_BULLET_MAX));
	}   
	else if(( SEMI_CLIP[id] == 1)) {
		wpn_playanim(id, random_num(anim_shoot1, anim_shoot3	));
		emit_sound(id, CHAN_WEAPON, s_FIRE, 1.0, ATTN_NORM, 0, PITCH_NORM);
		wpn_bullet_shot(g_wpnid, id, 0, random_num(DMG_PER_BULLET_MIN, DMG_PER_BULLET_MAX));
		client_cmd(id, "-attack")
	}
	else if(( SEMI_CLIP[id] == 2)) {
		wpn_playanim(id, random_num(anim_shoot1, anim_shoot2 /*Why not anim_shoot2 this time ? :D */	));
		emit_sound(id, CHAN_WEAPON, s_FIRE, 1.0, ATTN_NORM, 0, PITCH_NORM);
		wpn_bullet_shot(g_wpnid, id, 0, random_num(DMG_PER_BULLET_MIN, DMG_PER_BULLET_MAX));
		set_task(0.13,"info_burst",id,"",0,"",2)
	}
}
public info_burst(id){
	wpn_playanim(id, random_num(anim_shoot1, anim_shoot3	));
	emit_sound(id, CHAN_WEAPON, s_FIRE, 1.0, ATTN_NORM, 0, PITCH_NORM);
	wpn_bullet_shot(g_wpnid, id, 0, random_num(DMG_PER_BULLET_MIN, DMG_PER_BULLET_MAX));
	client_cmd(id, "-attack")
	new usrwpn = wpn_has_weapon(id,g_wpnid)
	wpn_set_userinfo(id,usr_wpn_ammo1,usrwpn,wpn_get_userinfo(id,usr_wpn_ammo1,usrwpn)-1)
}

public ev_attack2(id) {
	emit_sound(id, CHAN_WEAPON, s_SWAP, 1.0, ATTN_NORM, 0, PITCH_NORM);
	client_cmd(id, "-attack2")
	client_cmd(id, "-attack1")
	if(( SEMI_CLIP[id] == 0)) { 
		SEMI_CLIP[id] = 1;
		client_print(id, print_center,"Switching to Semi-Auto")
	} 
	else if(( SEMI_CLIP[id] == 1)) { 
		SEMI_CLIP[id] = 2; 
		client_print(id, print_center,"Switching to Burst-Fire")
	}
	else if(( SEMI_CLIP[id] == 2)) { 
		SEMI_CLIP[id] = 0; 
		client_print(id, print_center,"Switching to Auto-Matic")
	}
	return PLUGIN_CONTINUE
}

public client_connect(id){
	SEMI_CLIP[id] = 0
}

public ev_draw(id) {
	wpn_playanim(id, anim_draw);
	
	return PLUGIN_CONTINUE;
}

public ev_reload(id) {
	set_task(0.3,"ewwwww_reload_plox",id)	
	return PLUGIN_CONTINUE;
}
public ewwwww_reload_plox(id){
	wpn_playanim(id,anim_reload)
}